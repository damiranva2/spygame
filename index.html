<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>–ò–≥—Ä–∞ ‚Äú–®–ø–∏–æ–Ω‚Äù</title>
  <style>
    :root{
      --bg0:#070b14;
      --bg1:#0b1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --faint: rgba(255,255,255,.42);

      --a1:#7c3aed; /* violet */
      --a2:#06b6d4; /* cyan */
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 20px;
      --radius2: 28px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bot: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 900px at 15% 10%, rgba(124,58,237,.35), transparent 55%),
        radial-gradient(900px 700px at 85% 25%, rgba(6,182,212,.28), transparent 55%),
        radial-gradient(700px 700px at 45% 85%, rgba(34,197,94,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äú–ø–æ–¥ S23‚Äù: –ø—Ä–∏—è—Ç–Ω–∞—è —à–∏—Ä–∏–Ω–∞, –Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º */
    .wrap{
      min-height:100%;
      padding: calc(18px + var(--safe-top)) 16px calc(18px + var(--safe-bot));
      display:flex;
      justify-content:center;
    }
    .app{
      width: min(430px, 100%);
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 16px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      position: sticky;
      top: calc(10px + var(--safe-top));
      backdrop-filter: blur(12px);
      z-index: 5;
    }
    .brand{
      display:flex; flex-direction:column; line-height:1.1;
    }
    .brand .t{
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 18px;
    }
    .brand .s{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .chip{
      display:flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: linear-gradient(135deg, var(--a1), var(--a2));
      box-shadow: 0 0 0 4px rgba(124,58,237,.12);
    }

    main{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card .inner{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }

    .title{
      font-size: 18px;
      font-weight: 800;
      margin: 0;
    }
    .desc{
      margin:0;
      color: var(--muted);
      line-height: 1.35;
      font-size: 13px;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 13px;
    }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      user-select:none;
      -webkit-user-select:none;
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 750;
      color: rgba(255,255,255,.94);
      background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(6,182,212,.78));
      box-shadow: 0 18px 50px rgba(0,0,0,.38);
      transition: transform .12s ease, filter .12s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); filter: brightness(.95); }
    .btn.secondary{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color: var(--text);
      box-shadow: none;
    }
    .btn.danger{
      background: linear-gradient(135deg, rgba(239,68,68,.90), rgba(245,158,11,.82));
    }
    .btn.good{
      background: linear-gradient(135deg, rgba(34,197,94,.88), rgba(6,182,212,.78));
    }
    .btn.ghost{
      background: transparent;
      border: 1px solid rgba(255,255,255,.14);
      color: var(--muted);
      box-shadow:none;
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 360px){
      .grid2{ grid-template-columns:1fr; }
    }

    .input{
      width: 100%;
      border-radius: 16px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 650;
      outline:none;
    }
    .input:focus{
      border-color: rgba(6,182,212,.55);
      box-shadow: 0 0 0 4px rgba(6,182,212,.12);
    }

    .big{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: .2px;
      line-height: 1.05;
    }
    .wordBox{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.12);
      background: radial-gradient(900px 200px at 20% 10%, rgba(124,58,237,.25), transparent 55%),
                  radial-gradient(700px 220px at 80% 0%, rgba(6,182,212,.22), transparent 55%),
                  rgba(255,255,255,.05);
    }

    .hint{
      color: var(--faint);
      font-size: 12px;
      line-height: 1.25;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      font-size: 12px;
      color: var(--muted);
    }
    .tag .miniDot{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.6);
    }
    .tag.good .miniDot{ background: rgba(34,197,94,.95); }
    .tag.bad .miniDot{ background: rgba(239,68,68,.95); }
    .tag.warn .miniDot{ background: rgba(245,158,11,.95); }

    .footerNote{
      text-align:center;
      color: var(--faint);
      font-size: 12px;
      padding: 4px 0 0;
    }

    .fadeIn{ animation: fade .18s ease-out; }
    @keyframes fade{ from{ opacity:.0; transform: translateY(4px);} to{ opacity:1; transform: translateY(0);} }

    /* –ú–æ–¥–∞–ª–∫–∞ */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items: flex-end;
      justify-content:center;
      padding: 16px;
      padding-bottom: calc(16px + var(--safe-bot));
      z-index: 20;
    }
    .modal.show{ display:flex; }
    .sheet{
      width: min(430px, 100%);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(20,26,44,.96), rgba(9,14,26,.96));
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .sheet .top{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .sheet .top .h{
      font-weight: 850;
      font-size: 14px;
      color: var(--text);
    }
    .sheet .body{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* –ù–µ–≤–∏–¥–∏–º—ã–π/—Å–ª—É–∂–µ–±–Ω—ã–π */
    .hidden{ display:none !important; }

    /* –î–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞ */
    a{ color: inherit; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <header>
        <div class="brand">
          <div class="t">üïµÔ∏è –ò–≥—Ä–∞ ‚Äú–®–ø–∏–æ–Ω‚Äù</div>
          <div class="s">–ü–∞—Å—Å-—ç–Ω–¥-–ø–ª–µ–π ‚Ä¢ 1 —à–ø–∏–æ–Ω ‚Ä¢ —Ä—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞</div>
        </div>
        <div class="chip" title="–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω">
          <span class="dot"></span>
          <span>S23-friendly</span>
        </div>
      </header>

      <main id="main"></main>

      <div class="footerNote">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤–∫–ª—é—á–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ ‚Äú–≤–∞—É‚Äù.</div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Ä–æ–ª–∏ -->
  <div class="modal" id="modal">
    <div class="sheet">
      <div class="top">
        <div class="h" id="modalTitle">–ò–≥—Ä–æ–∫</div>
        <button class="btn ghost" id="modalClose">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="body" id="modalBody"></div>
    </div>
  </div>

<script>
(() => {
  // ====== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ======
  const WORDS_URL = "words.json";      // <- —Ç–≤–æ–π —Ñ–∞–π–ª —Å–æ —Å–ª–æ–≤–∞–º–∏ —Ä—è–¥–æ–º —Å html
  const MIN_PLAYERS = 3;
  const MAX_PLAYERS = 20;

  // ====== –°–æ—Å—Ç–æ—è–Ω–∏–µ ======
  const state = {
    words: null,
    players: 4,
    started: false,
    spyIndex: -1,
    word: "",
    revealed: new Set(),     // –∫–∞–∫–∏–µ –∏–≥—Ä–æ–∫–∏ —É–∂–µ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Ä–æ–ª—å
    phase: "setup",          // setup | reveal | play | end
    current: 1               // —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ (1..players) –¥–ª—è –≤—ã–¥–∞—á–∏ —Ä–æ–ª–∏
  };

  // ====== –£—Ç–∏–ª–∏—Ç—ã ======
  const $ = (sel, root=document) => root.querySelector(sel);
  const main = $("#main");

  function randInt(min, maxInclusive){
    return Math.floor(Math.random() * (maxInclusive - min + 1)) + min;
  }

  function pickRandom(arr){
    return arr[randInt(0, arr.length - 1)];
  }

  function clamp(n, a, b){
    return Math.max(a, Math.min(b, n));
  }

  function h(tag, attrs={}, ...children){
    const el = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs || {})){
      if (k === "class") el.className = v;
      else if (k.startsWith("on") && typeof v === "function") el.addEventListener(k.slice(2).toLowerCase(), v);
      else if (v !== null && v !== undefined) el.setAttribute(k, v);
    }
    for (const ch of children.flat()){
      if (ch === null || ch === undefined) continue;
      if (typeof ch === "string") el.appendChild(document.createTextNode(ch));
      else el.appendChild(ch);
    }
    return el;
  }

  function setScreen(node){
    main.innerHTML = "";
    main.appendChild(node);
    node.classList.add("fadeIn");
  }

  // ====== –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤ ======
  async function loadWords(){
    try{
      const res = await fetch(WORDS_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      if (!Array.isArray(data) || data.length < 10) throw new Error("words.json –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º —Å—Ç—Ä–æ–∫");
      // —á–∏—Å—Ç–∏–º/–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
      const words = data
        .filter(x => typeof x === "string")
        .map(x => x.trim())
        .filter(Boolean);
      if (words.length < 10) throw new Error("–í words.json —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ —Å–ª–æ–≤");
      state.words = words;
      return true;
    }catch(e){
      state.words = null;
      showWordsError(e);
      return false;
    }
  }

  function showWordsError(err){
    const card = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("div", {class:"row"},
          h("div", {class:"tag bad"}, h("span",{class:"miniDot"}), "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å words.json")
        ),
        h("p", {class:"desc"},
          "–ü–æ–ª–æ–∂–∏ —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML —Ñ–∞–π–ª ",
          h("b", {}, "words.json"),
          " (–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º). –û—Ç–∫—Ä–æ–π –∏–≥—Ä—É —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–≤–∞–∂–Ω–æ!)."
        ),
        h("div", {class:"wordBox"},
          h("div", {class:"hint"},
            "–ü–æ—á–µ–º—É –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å:\n" +
            "‚Ä¢ –û—Ç–∫—Ä—ã–ª(–∞) —Ñ–∞–π–ª –¥–≤–æ–π–Ω—ã–º –∫–ª–∏–∫–æ–º (file://) ‚Äî –±—Ä–∞—É–∑–µ—Ä —á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç fetch.\n" +
            "‚Ä¢ words.json –ª–µ–∂–∏—Ç –Ω–µ —Ä—è–¥–æ–º —Å html.\n" +
            "‚Ä¢ –í json –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\n\n" +
            "–†–µ—à–µ–Ω–∏–µ: –∑–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä. –ù–∞–ø—Ä–∏–º–µ—Ä:\n" +
            "1) —É—Å—Ç–∞–Ω–æ–≤–∏ Node.js\n" +
            "2) –≤ –ø–∞–ø–∫–µ —Å —Ñ–∞–π–ª–∞–º–∏: npx serve\n" +
            "–∏–ª–∏ Python: python -m http.server 8000"
          ),
          h("div", {class:"hint"}, "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: " + String(err?.message || err))
        ),
        h("button", {class:"btn secondary", onclick: () => location.reload()}, "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å")
      )
    );
    setScreen(card);
  }

  // ====== –ú–æ–¥–∞–ª–∫–∞ ======
  const modal = $("#modal");
  const modalTitle = $("#modalTitle");
  const modalBody = $("#modalBody");
  $("#modalClose").addEventListener("click", () => modal.classList.remove("show"));
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.remove("show");
  });

  function openModal(title, bodyNodes){
    modalTitle.textContent = title;
    modalBody.innerHTML = "";
    bodyNodes.forEach(n => modalBody.appendChild(n));
    modal.classList.add("show");
  }

  // ====== –≠–∫—Ä–∞–Ω—ã ======
  function screenSetup(){
    const playersInput = h("input", {
      class:"input",
      type:"number",
      inputmode:"numeric",
      min: String(MIN_PLAYERS),
      max: String(MAX_PLAYERS),
      value: String(state.players),
      "aria-label":"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤"
    });

    const spyMode = h("div", {class:"pill"},
      "üï∂Ô∏è –®–ø–∏–æ–Ω–æ–≤: ",
      h("b", {}, "1"),
      h("span", {style:"opacity:.65"}, " (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∑–∂–µ)")
    );

    const wordsStatus = state.words
      ? h("div", {class:"tag good"}, h("span",{class:"miniDot"}), `–°–ª–æ–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${state.words.length}`)
      : h("div", {class:"tag warn"}, h("span",{class:"miniDot"}), "–°–ª–æ–≤–∞: –∑–∞–≥—Ä—É–∑–∫–∞‚Ä¶");

    const startBtn = h("button", {
      class:"btn",
      disabled: !state.words,
      onclick: () => {
        const n = clamp(parseInt(playersInput.value || "0", 10), MIN_PLAYERS, MAX_PLAYERS);
        state.players = n;

        // —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        state.spyIndex = randInt(1, state.players); // 1..players
        state.word = pickRandom(state.words);
        state.revealed = new Set();
        state.phase = "reveal";
        state.current = 1;
        render();
      }
    }, "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É");

    const card = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("h2", {class:"title"}, "–ù–∞—Å—Ç—Ä–æ–π–∫–∞"),
        h("p", {class:"desc"},
          "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤. –ó–∞—Ç–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –ø–æ –∫—Ä—É–≥—É, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —É–≤–∏–¥–µ–ª —Å–≤–æ—é —Ä–æ–ª—å."
        ),
        h("div", {class:"divider"}),
        h("div", {class:"row"},
          h("div", {style:"flex:1; min-width:180px; display:flex; flex-direction:column; gap:8px;"},
            h("div", {class:"pill"}, "üë• –ò–≥—Ä–æ–∫–æ–≤: ", h("b", {}, String(state.players))),
            playersInput
          ),
          h("div", {style:"display:flex; flex-direction:column; gap:8px;"},
            spyMode,
            wordsStatus
          )
        ),
        h("div", {class:"grid2"},
          startBtn,
          h("button", {
            class:"btn secondary",
            onclick: () => openModal("–§–æ—Ä–º–∞—Ç words.json", [
              h("p", {class:"desc"},
                "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª ",
                h("b", {}, "words.json"),
                " —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML. –ü—Ä–∏–º–µ—Ä:"
              ),
              h("div", {class:"wordBox"},
                h("div", {class:"hint"},
                  '["—è–±–ª–æ–∫–æ","—Å–∞–º–æ–ª—ë—Ç","–º–æ–ª–æ–∫–æ","–∫–æ—Ñ–µ","—Ç–µ–∞—Ç—Ä"]'
                )
              ),
              h("p", {class:"desc"},
                "–ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –ª—É—á—à–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä/—Ö–æ—Å—Ç–∏–Ω–≥ (GitHub Pages —Ç–æ–∂–µ –ø–æ–¥–æ–π–¥—ë—Ç)."
              )
            ])
          }, "–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–ª–æ–≤–∞")
        )
      )
    );

    const tips = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("h2", {class:"title"}, "–ö–∞–∫ –∏–≥—Ä–∞—Ç—å"),
        h("p", {class:"desc"},
          "–í—Å–µ, –∫—Ä–æ–º–µ —à–ø–∏–æ–Ω–∞, –ø–æ–ª—É—á–∞—é—Ç –æ–¥–Ω–æ —Å–ª–æ–≤–æ. –®–ø–∏–æ–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ ‚Äú–¢—ã —à–ø–∏–æ–Ω‚Äù.",
          " –î–∞–ª—å—à–µ –≤—ã –ø–æ –∫—Ä—É–≥—É –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞–º—ë–∫–∏ –Ω–∞ —Å–ª–æ–≤–æ ‚Äî —Ç–∞–∫, —á—Ç–æ–±—ã —à–ø–∏–æ–Ω –Ω–µ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É, –Ω–æ –∏ —á—Ç–æ–±—ã —Å–≤–æ–∏ –ø–æ–Ω—è–ª–∏ üôÇ"
        ),
        h("div", {class:"row"},
          h("div", {class:"tag"}, h("span",{class:"miniDot"}), "–ü—Ä–∏–º–µ—Ä: —Å–ª–æ–≤–æ ‚Äú—è–±–ª–æ–∫–æ‚Äù"),
          h("div", {class:"tag"}, h("span",{class:"miniDot"}), "1: ‚Äú–∫—Ä–∞—Å–Ω–æ–µ‚Äù"),
          h("div", {class:"tag"}, h("span",{class:"miniDot"}), "2: ‚Äú–µ–¥–∞‚Äù"),
          h("div", {class:"tag"}, h("span",{class:"miniDot"}), "3: ‚Äú–º–µ—Ç–∞–ª–ª‚Äù (–ø–∞–ª–∏—Ç—Å—è üòÑ)")
        )
      )
    );

    setScreen(h("div", {}, card, tips));
  }

  function screenReveal(){
    const total = state.players;
    const i = state.current;

    const progress = h("div", {class:"row"},
      h("div", {class:"pill"}, "üé≠ –í—ã–¥–∞—á–∞ —Ä–æ–ª–µ–π"),
      h("div", {class:"pill"}, "–ò–≥—Ä–æ–∫ ", h("b", {}, String(i)), " –∏–∑ ", h("b", {}, String(total)))
    );

    const instructions = h("div", {class:"wordBox"},
      h("div", {class:"hint"},
        "–ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–≥—Ä–æ–∫—É ‚Ññ" + i + ".\n" +
        "–ü—É—Å—Ç—å –æ–Ω –Ω–∞–∂–º—ë—Ç –∫–Ω–æ–ø–∫—É ‚Äú–ü–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª—å‚Äù, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç, –∑–∞—Ç–µ–º –Ω–∞–∂–º—ë—Ç ‚Äú–°–∫—Ä—ã—Ç—å‚Äù –∏ –ø–µ—Ä–µ–¥–∞—Å—Ç —Å–ª–µ–¥—É—é—â–µ–º—É."
      )
    );

    const showRole = h("button", {
      class:"btn good",
      onclick: () => {
        const isSpy = (i === state.spyIndex);
        const body = [];

        body.push(h("div", {class:"row"},
          h("div", {class: isSpy ? "tag bad" : "tag good"}, h("span",{class:"miniDot"}),
            isSpy ? "–®–ü–ò–û–ù" : "–ù–ï –®–ü–ò–û–ù"
          )
        ));

        body.push(h("div", {class:"wordBox"},
          h("div", {class:"hint"}, "–¢–≤–æ—è —Ä–æ–ª—å:"),
          h("div", {class:"big"}, isSpy ? "–¢—ã —à–ø–∏–æ–Ω üïµÔ∏è" : "–¢–≤–æ—ë —Å–ª–æ–≤–æ"),
          h("div", {class:"big", style: isSpy ? "opacity:.25; filter: blur(0px);" : ""}, isSpy ? "‚Äî" : state.word),
          h("div", {class:"hint"},
            isSpy
              ? "–¢–≤–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–Ω—è—Ç—å —Å–ª–æ–≤–æ –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º –∏ –Ω–µ —Å–ø–∞–ª–∏—Ç—å—Å—è."
              : "–î–∞–≤–∞–π –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏: —á—Ç–æ–±—ã —Å–≤–æ–∏ –ø–æ–Ω—è–ª–∏, –∞ —à–ø–∏–æ–Ω ‚Äî –Ω–µ —Å—Ä–∞–∑—É."
          )
        ));

        body.push(h("button", {
          class:"btn secondary",
          onclick: () => {
            modal.classList.remove("show");
            // –æ—Ç–º–µ—á–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä
            state.revealed.add(i);

            // —Å–ª–µ–¥—É—é—â–∏–π –∏–≥—Ä–æ–∫ –∏–ª–∏ –∫–æ–Ω–µ—Ü –≤—ã–¥–∞—á–∏
            if (state.current < state.players) {
              state.current += 1;
              render();
            } else {
              state.phase = "play";
              render();
            }
          }
        }, "–°–∫—Ä—ã—Ç—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ"));

        openModal("–ò–≥—Ä–æ–∫ ‚Ññ" + i, body);
      }
    }, "–ü–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª—å");

    const resetBtn = h("button", {
      class:"btn secondary",
      onclick: () => {
        state.phase = "setup";
        state.started = false;
        state.spyIndex = -1;
        state.word = "";
        state.revealed = new Set();
        state.current = 1;
        render();
      }
    }, "–°–±—Ä–æ—Å–∏—Ç—å");

    const card = h("div", {class:"card"},
      h("div", {class:"inner"},
        progress,
        h("p", {class:"desc"},
          "–í–∞–∂–Ω–æ: —Å–º–æ—Ç—Ä–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫. –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è üôÇ"
        ),
        instructions,
        h("div", {class:"grid2"},
          showRole,
          resetBtn
        )
      )
    );

    setScreen(card);
  }

  function screenPlay(){
    const total = state.players;

    const top = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("h2", {class:"title"}, "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å"),
        h("p", {class:"desc"},
          "–í—Å–µ —Ä–æ–ª–∏ –≤—ã–¥–∞–Ω—ã. –¢–µ–ø–µ—Ä—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ: —Ö–æ–¥–∏—Ç–µ –ø–æ –∫—Ä—É–≥—É –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞–º—ë–∫ –Ω–∞ —Å–ª–æ–≤–æ.",
          " –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é/—Ä–∞—Å–∫—Ä—ã—Ç–∏—é."
        ),
        h("div", {class:"row"},
          h("div", {class:"tag good"}, h("span",{class:"miniDot"}), `–ò–≥—Ä–æ–∫–æ–≤: ${total}`),
          h("div", {class:"tag warn"}, h("span",{class:"miniDot"}), "–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–ª–æ–≤–æ –≤—Å–ª—É—Ö üòÑ"),
          h("div", {class:"tag"}, h("span",{class:"miniDot"}), "1 —à–ø–∏–æ–Ω")
        ),
        h("div", {class:"divider"}),
        h("div", {class:"grid2"},
          h("button", {
            class:"btn",
            onclick: () => {
              state.phase = "end";
              render();
            }
          }, "–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ / —Ä–∞—Å–∫—Ä—ã—Ç—å"),
          h("button", {
            class:"btn secondary",
            onclick: () => openModal("–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫", [
              h("p", {class:"desc"},
                "–ò–¥–µ–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏: –Ω–µ —Å–ª–∏—à–∫–æ–º –æ—á–µ–≤–∏–¥–Ω—ã–µ, –Ω–æ –∏ –Ω–µ —Å–ª–∏—à–∫–æ–º ‚Äú–≤ –∫–æ—Å–º–æ—Å‚Äù. –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–∞:"
              ),
              h("div", {class:"wordBox"},
                h("div", {class:"hint"},
                  "‚Ä¢ –∫–∞—á–µ—Å—Ç–≤–æ/—Å–≤–æ–π—Å—Ç–≤–æ (–º—è–≥–∫–æ–µ, —Ö–æ–ª–æ–¥–Ω–æ–µ, –∫—Ä—É–≥–ª–æ–µ)\n" +
                  "‚Ä¢ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è (–ª–µ—Ç–æ, –¥–µ—Ç—Å—Ç–≤–æ)\n" +
                  "‚Ä¢ –∫–∞—Ç–µ–≥–æ—Ä–∏—è (—Ç–µ—Ö–Ω–∏–∫–∞, –µ–¥–∞, –º–µ—Å—Ç–æ)\n" +
                  "‚Ä¢ –¥–µ–π—Å—Ç–≤–∏–µ (—Ä–µ–∂—É—Ç, –≤–∫–ª—é—á–∞—é—Ç)\n" +
                  "‚Ä¢ –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è (–∫—É—Ö–Ω—è, —É–ª–∏—Ü–∞, —à–∫–æ–ª–∞)"
                )
              ),
              h("p", {class:"desc"},
                "–®–ø–∏–æ–Ω—É —Å–ª–æ–∂–Ω–æ, –µ—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∏ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç–µ —Å—É–ø–µ—Ä-–ø—Ä—è–º–æ."
              )
            ])
          }, "–®–ø–∞—Ä–≥–∞–ª–∫–∞")
        )
      )
    );

    const reminder = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("h2", {class:"title"}, "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –∑–∞–±—ã–ª —Ä–æ–ª—å"),
        h("p", {class:"desc"},
          "–ú–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª–∏ –ø–æ –æ–¥–Ω–æ–º—É ‚Äî –Ω–æ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ."
        ),
        h("button", {
          class:"btn secondary",
          onclick: () => {
            state.phase = "reveal";
            state.current = 1;
            state.revealed = new Set();
            render();
          }
        }, "–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≤—ã–¥–∞—á–∞ —Ä–æ–ª–µ–π")
      )
    );

    setScreen(h("div", {}, top, reminder));
  }

  function screenEnd(){
    const total = state.players;

    const guessInput = h("input", {
      class:"input",
      type:"number",
      inputmode:"numeric",
      min: "1",
      max: String(total),
      placeholder: "–ù–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞ (1.." + total + ")"
    });

    const revealBtn = h("button", {
      class:"btn danger",
      onclick: () => {
        const guess = clamp(parseInt(guessInput.value || "0", 10), 1, total);
        const ok = (guess === state.spyIndex);

        openModal("–†–µ–∑—É–ª—å—Ç–∞—Ç", [
          h("div", {class:"row"},
            h("div", {class: ok ? "tag good" : "tag bad"}, h("span",{class:"miniDot"}),
              ok ? "–®–ø–∏–æ–Ω–∞ –Ω–∞—à–ª–∏!" : "–ù–µ —É–≥–∞–¥–∞–ª–∏!"
            )
          ),
          h("div", {class:"wordBox"},
            h("div", {class:"hint"}, "–°–µ–∫—Ä–µ—Ç—ã –∏–≥—Ä—ã:"),
            h("div", {class:"big"}, "–®–ø–∏–æ–Ω: –∏–≥—Ä–æ–∫ ‚Ññ" + state.spyIndex),
            h("div", {class:"big"}, "–°–ª–æ–≤–æ: " + state.word),
            h("div", {class:"hint"},
              ok
                ? "–ö—Ä–∞—Å–∏–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É."
                : "–ë—ã–≤–∞–µ—Ç üôÇ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ ‚Äî –∏ –¥–µ–ª–∞–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —á—É—Ç—å –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ."
            )
          ),
          h("div", {class:"grid2"},
            h("button", {
              class:"btn good",
              onclick: () => {
                modal.classList.remove("show");
                // –Ω–æ–≤–∞—è –∏–≥—Ä–∞ —Å —Ç–µ–º –∂–µ —á–∏—Å–ª–æ–º –∏–≥—Ä–æ–∫–æ–≤
                state.spyIndex = randInt(1, state.players);
                state.word = pickRandom(state.words);
                state.revealed = new Set();
                state.phase = "reveal";
                state.current = 1;
                render();
              }
            }, "–ù–æ–≤–∞—è –∏–≥—Ä–∞"),
            h("button", {
              class:"btn secondary",
              onclick: () => {
                modal.classList.remove("show");
                state.phase = "setup";
                state.spyIndex = -1;
                state.word = "";
                state.revealed = new Set();
                state.current = 1;
                render();
              }
            }, "–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏")
          )
        ]);
      }
    }, "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å / —Ä–∞—Å–∫—Ä—ã—Ç—å");

    const card = h("div", {class:"card"},
      h("div", {class:"inner"},
        h("h2", {class:"title"}, "–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ"),
        h("p", {class:"desc"},
          "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ —à–ø–∏–æ–Ω–æ–º. –ü–æ—Ç–æ–º –∏–≥—Ä–∞ —Ä–∞—Å–∫—Ä–æ–µ—Ç —à–ø–∏–æ–Ω–∞ –∏ —Å–ª–æ–≤–æ."
        ),
        guessInput,
        h("div", {class:"grid2"},
          revealBtn,
          h("button", {
            class:"btn secondary",
            onclick: () => {
              state.phase = "play";
              render();
            }
          }, "–ù–∞–∑–∞–¥ –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é")
        ),
        h("div", {class:"divider"}),
        h("p", {class:"desc"},
          "–•–æ—á–µ—à—å —Ä–µ–∂–∏–º –ø–æ—Å–ª–æ–∂–Ω–µ–µ? –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 2 —à–ø–∏–æ–Ω–∞, —Ç–∞–π–º–µ—Ä, –∏–ª–∏ –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî —Å–∫–∞–∂–∏, –¥–æ–±–∞–≤–ª—é."
        )
      )
    );

    setScreen(card);
  }

  function render(){
    if (!state.words) return; // –ø–æ–∫–∞ –≥—Ä—É–∑–∏—Ç—Å—è
    if (state.phase === "setup") return screenSetup();
    if (state.phase === "reveal") return screenReveal();
    if (state.phase === "play") return screenPlay();
    if (state.phase === "end") return screenEnd();
  }

  // ====== –°—Ç–∞—Ä—Ç ======
  (async function init(){
    // –ø–æ–∫–∞–∂–µ–º –±—ã—Å—Ç—Ä—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
    setScreen(
      h("div", {class:"card"},
        h("div", {class:"inner"},
          h("h2", {class:"title"}, "–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"),
          h("p", {class:"desc"}, "–ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –∏–∑ words.json")
        )
      )
    );

    const ok = await loadWords();
    if (!ok) return;

    state.phase = "setup";
    render();
  })();
})();
</script>
</body>
</html>
