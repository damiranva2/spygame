<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ò–≥—Ä–∞ ¬´–®–ø–∏–æ–Ω¬ª</title>

  <style>
    :root{
      /* –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ */
      --bg: #0b0f17;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.75);
      --border: rgba(255,255,255,.14);

      --ok: #18c964;
      --danger: #ff3b30;
      --warn: #ffcc00;

      --shadow: 0 18px 50px rgba(0,0,0,.42);
      --radius: 18px;

      /* –°—Ç–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–≥—Ä–∞–¥–∏–µ–Ω—Ç—ã) */
      --grad: radial-gradient(1200px 600px at 20% 0%, rgba(93,182,255,.30), transparent 55%),
              radial-gradient(900px 500px at 90% 10%, rgba(255,97,214,.22), transparent 60%),
              radial-gradient(1000px 700px at 40% 110%, rgba(43,255,192,.16), transparent 55%),
              linear-gradient(180deg, #070a10 0%, #0b0f17 38%, #070a10 100%);

      /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∂–∏–º */
      --mini-bg: #2b2b2b;
      --mini-card: #3a3a3a;
      --mini-card2: #444;
      --mini-text: #f2f2f2;
      --mini-muted: rgba(242,242,242,.75);
      --mini-border: rgba(255,255,255,.14);
      --mini-shadow: 0 12px 28px rgba(0,0,0,.35);
    }

    /* –£—á–∏—Ç—ã–≤–∞–µ–º safe-area –Ω–∞ Samsung/Android */
    body{
      margin: 0;
      min-height: 100vh;
      background: var(--grad);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
    }

    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∂–∏–º */
    body.minimal{
      background: var(--mini-bg);
      color: var(--mini-text);
    }

    .app{
      width: 100%;
      max-width: 520px; /* –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥ 6.6" FHD+ ‚Äî –Ω–µ —Ä–∞–∑—ä–µ–∑–∂–∞–µ—Ç—Å—è –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö */
      margin: 0 auto;
      padding: calc(18px + env(safe-area-inset-top)) 16px calc(18px + env(safe-area-inset-bottom)) 16px;
      box-sizing: border-box;
    }

    header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .brand{
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title{
      font-size: 22px;
      font-weight: 800;
      letter-spacing: .2px;
      line-height: 1.15;
    }
    .subtitle{
      font-size: 13px;
      color: var(--muted);
    }
    body.minimal .subtitle{ color: var(--mini-muted); }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      user-select: none;
    }
    body.minimal .pill{
      background: var(--mini-card);
      border-color: var(--mini-border);
      box-shadow: var(--mini-shadow);
    }

    .pill span{
      font-size: 13px;
      color: var(--muted);
    }
    body.minimal .pill span{ color: var(--mini-muted); }

    /* Switch */
    .switch{
      position: relative;
      width: 44px;
      height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.16);
      flex: 0 0 auto;
    }
    body.minimal .switch{
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.18);
    }
    .knob{
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      transition: transform .18s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .switch.on .knob{ transform: translateX(18px); }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(14px);
    }
    body.minimal .card{
      background: var(--mini-card);
      border-color: var(--mini-border);
      box-shadow: var(--mini-shadow);
      backdrop-filter: none;
    }

    .stack{ display: flex; flex-direction: column; gap: 12px; }

    .row{ display: flex; gap: 10px; align-items: center; }
    .row.wrap{ flex-wrap: wrap; }

    label{
      font-size: 13px;
      color: var(--muted);
    }
    body.minimal label{ color: var(--mini-muted); }

    input[type="number"]{
      width: 100%;
      height: 44px;
      padding: 0 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size: 16px;
      outline: none;
      box-sizing: border-box;
    }
    body.minimal input[type="number"]{
      background: rgba(0,0,0,.25);
      color: var(--mini-text);
      border-color: var(--mini-border);
    }
    input[type="number"]:focus{
      border-color: rgba(93,182,255,.55);
      box-shadow: 0 0 0 3px rgba(93,182,255,.16);
    }

    .btn{
      width: 100%;
      height: 46px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.12);
      color: var(--text);
      font-size: 16px;
      font-weight: 700;
      letter-spacing: .2px;
      box-shadow: 0 14px 35px rgba(0,0,0,.33);
      cursor: pointer;
      user-select: none;
      transition: transform .06s ease, filter .18s ease;
    }
    body.minimal .btn{
      background: var(--mini-card2);
      border-color: rgba(255,255,255,.14);
      color: var(--mini-text);
      box-shadow: var(--mini-shadow);
    }
    .btn:active{ transform: scale(.99); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(93,182,255,.95), rgba(255,97,214,.9));
      border: 0;
    }
    body.minimal .btn.primary{
      background: #555;
      border: 1px solid rgba(255,255,255,.14);
    }

    .btn.ok{
      background: rgba(24,201,100,.18);
      border-color: rgba(24,201,100,.38);
    }
    .btn.danger{
      background: rgba(255,59,48,.18);
      border-color: rgba(255,59,48,.38);
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }
    body.minimal .hint{ color: var(--mini-muted); }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      font-size: 12px;
      color: var(--muted);
    }
    body.minimal .badge{
      background: rgba(0,0,0,.18);
      color: var(--mini-muted);
    }

    /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ (–∑–µ–ª—ë–Ω–æ–µ/–∫—Ä–∞—Å–Ω–æ–µ) */
    .reveal{
      position: fixed;
      inset: 0;
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      box-sizing: border-box;
      text-align: center;
    }
    .reveal.show{ display: flex; }
    .reveal.normal{
      background: radial-gradient(1200px 900px at 50% 10%, rgba(255,255,255,.20), transparent 55%),
                  linear-gradient(180deg, rgba(24,201,100,.95), rgba(14,124,63,.98));
    }
    .reveal.spy{
      background: radial-gradient(1200px 900px at 50% 10%, rgba(255,255,255,.16), transparent 55%),
                  linear-gradient(180deg, rgba(255,59,48,.95), rgba(128,12,10,.98));
    }
    body.minimal .reveal.normal{ background: #198754; }
    body.minimal .reveal.spy{ background: #b42318; }

    .revealBox{
      width: 100%;
      max-width: 520px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.22);
      border-radius: 22px;
      padding: 18px 16px;
      box-shadow: 0 24px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    body.minimal .revealBox{
      background: rgba(0,0,0,.20);
      backdrop-filter: none;
    }

    .revealTitle{
      font-size: 14px;
      opacity: .9;
      margin-bottom: 10px;
      letter-spacing: .3px;
    }
    .revealMain{
      font-size: clamp(34px, 6vw, 46px);
      font-weight: 900;
      line-height: 1.05;
      margin-bottom: 12px;
    }
    .revealSub{
      font-size: 14px;
      opacity: .92;
      line-height: 1.35;
      margin-bottom: 16px;
    }

    .smallBtns{
      display: flex;
      gap: 10px;
    }
    .smallBtns .btn{ height: 44px; }

    .divider{
      height: 1px;
      background: rgba(255,255,255,.14);
      margin: 10px 0;
    }
    body.minimal .divider{ background: rgba(255,255,255,.12); }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    /* –ù–µ–±–æ–ª—å—à–∞—è ‚Äú–ø—Ä—É–∂–∏–Ω–∫–∞‚Äù –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ (90 –ì—Ü –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏—è—Ç–Ω–æ) */
    * { scroll-behavior: smooth; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="title">–ò–≥—Ä–∞ ¬´–®–ø–∏–æ–Ω¬ª</div>
        <div class="subtitle">–ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ –∫—Ä—É–≥—É ‚Äî —à–ø–∏–æ–Ω —É–≤–∏–¥–∏—Ç —ç—Ç–æ üëÄ</div>
      </div>

      <div class="pill" role="group" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞">
        <span>–ú–∏–Ω–∏–º–∞–ª</span>
        <div id="modeSwitch" class="switch" tabindex="0" role="switch" aria-checked="false" aria-label="–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∂–∏–º">
          <div class="knob"></div>
        </div>
      </div>
    </header>

    <!-- –≠–∫—Ä–∞–Ω: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ -->
    <section id="screenSetup" class="stack">
      <div class="card stack">
        <div class="row wrap" style="justify-content: space-between;">
          <div class="badge">üì± –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ 6.6" (FHD+ 1080√ó2408)</div>
          <div class="badge mono" id="wordsStatus">–°–ª–æ–≤–∞: –∑–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
        </div>

        <div class="divider"></div>

        <div class="stack">
          <div>
            <label for="players">–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤?</label>
            <div style="height: 6px"></div>
            <input id="players" type="number" min="3" max="20" value="5" inputmode="numeric" />
            <div style="height: 8px"></div>
            <div class="hint">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3‚Äì12. –®–ø–∏–æ–Ω –±—É–¥–µ—Ç –æ–¥–∏–Ω.</div>
          </div>

          <button id="btnStart" class="btn primary">–ù–∞—á–∞—Ç—å —Ä–∞–∑–¥–∞—á—É</button>

          <button id="btnHow" class="btn">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
        </div>
      </div>

      <div id="howBox" class="card stack" style="display:none;">
        <div style="font-weight: 800; font-size: 16px;">–ü—Ä–∞–≤–∏–ª–∞ (–∫–æ—Ä–æ—Ç–∫–æ)</div>
        <div class="hint">
          1) –í—Å–µ–º –∏–≥—Ä–æ–∫–∞–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–ª–æ–≤–æ.<br>
          2) –®–ø–∏–æ–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ ¬´–®–ü–ò–û–ù¬ª.<br>
          3) –ü–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏ –≤—ã –æ–±—Å—É–∂–¥–∞–µ—Ç–µ: –ø–æ –∫—Ä—É–≥—É –Ω–∞–∑—ã–≤–∞–µ—Ç–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏/–ø–æ–¥—Å–∫–∞–∑–∫–∏ –∫ —Å–ª–æ–≤—É.<br>
          4) –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ ¬´–º–∏–º–æ¬ª ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –æ–Ω —à–ø–∏–æ–Ω üòÑ
        </div>
        <button id="btnHideHow" class="btn">–ü–æ–Ω—è—Ç–Ω–æ</button>
      </div>
    </section>

    <!-- –≠–∫—Ä–∞–Ω: –†–∞–∑–¥–∞—á–∞ -->
    <section id="screenDeal" class="stack" style="display:none;">
      <div class="card stack">
        <div class="row wrap" style="justify-content: space-between;">
          <div class="badge">üé≠ –†–∞–∑–¥–∞—á–∞</div>
          <div class="badge mono" id="dealProgress">–ò–≥—Ä–æ–∫ 1 / 5</div>
        </div>

        <div class="divider"></div>

        <div style="text-align:center;" class="stack">
          <div style="font-weight:900; font-size: 18px;">–ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–≥—Ä–æ–∫—É</div>
          <div id="dealPlayer" style="font-weight:900; font-size: 34px; letter-spacing:.4px;">‚Ññ1</div>
          <div class="hint">–ò–≥—Ä–æ–∫ ‚Ññ1 –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Äî —É–≤–∏–¥–∏—Ç —Å–≤–æ—é —Ä–æ–ª—å/—Å–ª–æ–≤–æ. –ü–æ—Ç–æ–º —Å–Ω–æ–≤–∞ —Å–∫—Ä—ã—Ç—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–º—É.</div>

          <button id="btnReveal" class="btn ok">–ü–æ–∫–∞–∑–∞—Ç—å</button>
          <button id="btnReset" class="btn danger">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
        </div>
      </div>

      <div class="card stack">
        <div style="font-weight: 800;">–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏</div>
        <div class="hint">
          –í–æ –≤—Ä–µ–º—è —Ä–∞–∑–¥–∞—á–∏ –¥–µ—Ä–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –±–ª–∏–∂–µ –∫ —Å–µ–±–µ, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –Ω–µ –ø–æ–¥—Å–º–æ—Ç—Ä–µ–ª–∏.
          –ü–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ ‚Äî —Å—Ä–∞–∑—É –∂–º–∏—Ç–µ ¬´–°–∫—Ä—ã—Ç—å¬ª.
        </div>
      </div>
    </section>

    <!-- –≠–∫—Ä–∞–Ω: –ü–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏ -->
    <section id="screenAfter" class="stack" style="display:none;">
      <div class="card stack">
        <div class="row wrap" style="justify-content: space-between;">
          <div class="badge">‚úÖ –†–∞–∑–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</div>
          <div class="badge mono" id="afterInfo">–ò–≥—Ä–æ–∫–æ–≤: 5</div>
        </div>

        <div class="divider"></div>

        <div class="stack">
          <div style="font-weight:900; font-size: 18px;">–û–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å</div>
          <div class="hint">
            –ò–¥–∏—Ç–µ –ø–æ –∫—Ä—É–≥—É –∏ –Ω–∞–∑—ã–≤–∞–π—Ç–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –∫ —Å–ª–æ–≤—É (–æ–¥–Ω–∏–º-–¥–≤—É–º—è —Å–ª–æ–≤–∞–º–∏).
            –®–ø–∏–æ–Ω –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ –ø–æ –≤–∞—à–∏–º –ø–æ–¥—Å–∫–∞–∑–∫–∞–º.
          </div>

          <button id="btnNewRound" class="btn primary">–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥</button>
          <button id="btnReset2" class="btn danger">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
        </div>
      </div>

      <div class="card stack">
        <div style="font-weight:800;">–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ¬´–ø–æ-—á–µ—Å—Ç–Ω–æ–º—É¬ª</div>
        <div class="hint">
          –ù–µ –Ω–∞–∑—ã–≤–∞–π—Ç–µ —Å–ª–æ–≤–æ –Ω–∞–ø—Ä—è–º—É—é. –ì–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞–º—ë–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–∫—Ä–∞—Å–Ω–æ–µ¬ª, ¬´–µ–¥–∞¬ª, ¬´–∫—Ä—É–≥–ª–æ–µ¬ª).
        </div>
      </div>
    </section>
  </div>

  <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ -->
  <div id="reveal" class="reveal" aria-live="polite">
    <div class="revealBox">
      <div class="revealTitle" id="revealTitle">–ò–≥—Ä–æ–∫ ‚Ññ1</div>
      <div class="revealMain" id="revealMain">–°–õ–û–í–û</div>
      <div class="revealSub" id="revealSub">–ù–∏–∫–æ–º—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π. –ó–∞–ø–æ–º–Ω–∏ –∏ –Ω–∞–∂–º–∏ ¬´–°–∫—Ä—ã—Ç—å¬ª.</div>

      <div class="smallBtns">
        <button id="btnHide" class="btn">–°–∫—Ä—ã—Ç—å</button>
        <button id="btnShowAgain" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
      </div>
    </div>
  </div>

  <script>
    /**
     * ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–≤–æ–µ–≥–æ JSON —Å–æ —Å–ª–æ–≤–∞–º–∏:
     * –ü–æ–ª–æ–∂–∏ —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML —Ñ–∞–π–ª words.json –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
     * ["—è–±–ª–æ–∫–æ","—Å—Ç–æ–ª","–º–∞—à–∏–Ω–∞", ...]
     *
     * –ò–ª–∏ –æ–±—ä–µ–∫—Ç:
     * { "words": ["—è–±–ª–æ–∫–æ","—Å—Ç–æ–ª", ...] }
     */
    const WORDS_URL = "words.json";

    const $ = (id) => document.getElementById(id);

    // –≠–∫—Ä–∞–Ω—ã
    const screenSetup = $("screenSetup");
    const screenDeal  = $("screenDeal");
    const screenAfter = $("screenAfter");

    // UI
    const playersInput = $("players");
    const wordsStatus  = $("wordsStatus");
    const howBox       = $("howBox");

    const dealProgress = $("dealProgress");
    const dealPlayer   = $("dealPlayer");

    const revealOverlay = $("reveal");
    const revealTitle   = $("revealTitle");
    const revealMain    = $("revealMain");
    const revealSub     = $("revealSub");

    const modeSwitch = $("modeSwitch");

    // –ö–Ω–æ–ø–∫–∏
    const btnStart    = $("btnStart");
    const btnReveal   = $("btnReveal");
    const btnHide     = $("btnHide");
    const btnShowAgain= $("btnShowAgain");
    const btnReset    = $("btnReset");
    const btnReset2   = $("btnReset2");
    const btnNewRound = $("btnNewRound");

    const btnHow      = $("btnHow");
    const btnHideHow  = $("btnHideHow");

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    const state = {
      words: [],
      playerCount: 5,
      spyIndex: 0,      // 1..N
      secretWord: "",
      currentPlayer: 1,
      lastRevealFor: 1,
      revealedThisPlayer: false
    };

    // --- –†–µ–∂–∏–º (—Å—Ç–∏–ª—å–Ω—ã–π/–º–∏–Ω–∏–º–∞–ª) ---
    function setMinimal(on){
      document.body.classList.toggle("minimal", on);
      modeSwitch.classList.toggle("on", on);
      modeSwitch.setAttribute("aria-checked", on ? "true" : "false");
      localStorage.setItem("spy_minimal", on ? "1" : "0");
    }
    function toggleMinimal(){
      setMinimal(!document.body.classList.contains("minimal"));
    }
    modeSwitch.addEventListener("click", toggleMinimal);
    modeSwitch.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleMinimal();
      }
    });

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤ ---
    async function loadWords(){
      try{
        const res = await fetch(WORDS_URL, { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        let list = [];
        if(Array.isArray(data)) list = data;
        else if(data && Array.isArray(data.words)) list = data.words;

        list = list
          .map(w => String(w).trim())
          .filter(w => w.length >= 2);

        if(list.length < 10) throw new Error("–ú–∞–ª–æ —Å–ª–æ–≤ –≤ JSON");

        state.words = list;
        wordsStatus.textContent = "–°–ª–æ–≤–∞: " + list.length;
      }catch(err){
        // –§–æ–ª–±—ç–∫ (–µ—Å–ª–∏ words.json –Ω–µ—Ç —Ä—è–¥–æ–º) ‚Äî —á—Ç–æ–±—ã –∏–≥—Ä–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–∞
        const fallback = [
  "—è–±–ª–æ–∫–æ","—Ç–µ–ª–µ—Ñ–æ–Ω","—Å–∞–º–æ–ª—ë—Ç","–∫–æ—Ñ–µ","–ø–∏—Ä–∞–º–∏–¥–∞","—à–∫–æ–ª–∞","–∫–Ω–∏–≥–∞","–º–æ—Ä–µ","–∫–æ—Å–º–æ—Å","—Å–Ω–µ–≥",
  "–º—É–∑—ã–∫–∞","–∫–æ–º–ø—å—é—Ç–µ—Ä","—Å—Ç—É–ª","–∫–∞—Ä—Ç–∞","—à–æ–∫–æ–ª–∞–¥","–ø–∏—Ü—Ü–∞","–ø–∞—Ä–∫","–∫–∏–Ω–æ","–≥–∏—Ç–∞—Ä–∞","–ø–æ–µ–∑–¥",
  "–¥–æ–º","–æ–∫–Ω–æ","–¥–≤–µ—Ä—å","—Å—Ç–æ–ª","–ª–∞–º–ø–∞","—á–∞—Å—ã","—Ä—É—á–∫–∞","–∫–∞—Ä–∞–Ω–¥–∞—à","—Ç–µ—Ç—Ä–∞–¥—å","—Ä—é–∫–∑–∞–∫",
  "–±—É—Ç—ã–ª–∫–∞","—Å—Ç–∞–∫–∞–Ω","—Ç–∞—Ä–µ–ª–∫–∞","–≤–∏–ª–∫–∞","–ª–æ–∂–∫–∞","–Ω–æ–∂","–∫–∞—Å—Ç—Ä—é–ª—è","—Å–∫–æ–≤–æ—Ä–æ–¥–∞","—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫","–ø–µ—á—å",
  "–∫—Ä–æ–≤–∞—Ç—å","–ø–æ–¥—É—à–∫–∞","–æ–¥–µ—è–ª–æ","–∫–æ–≤—ë—Ä","—à–∫–∞—Ñ","–ø–æ–ª–∫–∞","–∑–µ—Ä–∫–∞–ª–æ","–¥–∏–≤–∞–Ω","–∫—Ä–µ—Å–ª–æ","—à—Ç–æ—Ä–∞",
  "–æ–±—É–≤—å","–∫—É—Ä—Ç–∫–∞","–ø–∞–ª—å—Ç–æ","—à–∞–ø–∫–∞","—à–∞—Ä—Ñ","–ø–µ—Ä—á–∞—Ç–∫–∏","—Ä—É–±–∞—à–∫–∞","–±—Ä—é–∫–∏","–¥–∂–∏–Ω—Å—ã","–ø–ª–∞—Ç—å–µ",
  "–∫–ª—é—á","–∑–∞–º–æ–∫","–º–æ–Ω–µ—Ç–∞","–∫—É–ø—é—Ä–∞","–∫–æ—à–µ–ª—ë–∫","—Å—É–º–∫–∞","—á–µ–º–æ–¥–∞–Ω","–ø–∞—Å–ø–æ—Ä—Ç","–±–∏–ª–µ—Ç","–∫–∞—Ä–º–∞–Ω",
  "–º–∞—à–∏–Ω–∞","–≤–µ–ª–æ—Å–∏–ø–µ–¥","—Å–∞–º–æ–∫–∞—Ç","–º–æ—Ç–æ—Ü–∏–∫–ª","–∞–≤—Ç–æ–±—É—Å","—Ç—Ä–∞–º–≤–∞–π","–º–µ—Ç—Ä–æ","–¥–æ—Ä–æ–≥–∞","–º–æ—Å—Ç","—Ç–æ–Ω–Ω–µ–ª—å",
  "–∫–∞–º–µ–Ω—å","–ø–µ—Å–æ–∫","–≥–ª–∏–Ω–∞","–¥–µ—Ä–µ–≤–æ","–ª–∏—Å—Ç","–≤–µ—Ç–∫–∞","—Ü–≤–µ—Ç–æ–∫","—Ç—Ä–∞–≤–∞","–∫–æ—Ä–µ–Ω—å","—Å–µ–º—è",
  "—Ä–µ–∫–∞","–æ–∑–µ—Ä–æ","–ø—Ä—É–¥","–≤–æ–¥–æ–ø–∞–¥","–±–µ—Ä–µ–≥","–æ—Å—Ç—Ä–æ–≤","–≥–æ—Ä–∞","—Å–∫–∞–ª–∞","–ø–µ—â–µ—Ä–∞","–¥–æ–ª–∏–Ω–∞",
  "–º—è—á","–∫—É–∫–ª–∞","–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä","–ø–∞–∑–ª","–∏–≥—Ä—É—à–∫–∞","—Ä–æ–±–æ—Ç","–º–∞—à–∏–Ω–∫–∞","–º–µ–¥–≤–µ–∂–æ–Ω–æ–∫","—à–∞—Ä–∏–∫","—é–ª–∞",
  "—Ç–µ–ª–µ–≤–∏–∑–æ—Ä","–ø—É–ª—å—Ç","—ç–∫—Ä–∞–Ω","–∫–∞–º–µ—Ä–∞","—Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç","–Ω–∞—É—à–Ω–∏–∫–∏","–∫–æ–ª–æ–Ω–∫–∞","–º–∏–∫—Ä–æ—Ñ–æ–Ω","–ø—Ä–æ–≤–æ–¥","—Ä–æ–∑–µ—Ç–∫–∞",
  "–º–æ–ª–æ—Ç–æ–∫","–≥–≤–æ–∑–¥—å","–æ—Ç–≤—ë—Ä—Ç–∫–∞","–ø–∏–ª–∞","–¥—Ä–µ–ª—å","–∫–ª—é—á–∏–∫","–±–æ–ª—Ç","–≥–∞–π–∫–∞","–ø–ª–æ—Å–∫–æ–≥—É–±—Ü—ã","—Ä—É–ª–µ—Ç–∫–∞",
  "–∑–æ–Ω—Ç","—Ñ–æ–Ω–∞—Ä—å","—Å–≤–µ—á–∞","—Å–ø–∏—á–∫–∏","–æ–≥–æ–Ω—å","–¥—ã–º","–ø–µ–ø–µ–ª","—É–≥–æ–ª—å","–±—Ä–µ–≤–Ω–æ","–¥–æ—Å–∫–∞",
  "–ø–∞–∫–µ—Ç","–∫–æ—Ä–æ–±–∫–∞","—è—â–∏–∫","–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä","–±–∞–Ω–∫–∞","–∫–æ–Ω–≤–µ—Ä—Ç","–±—É–º–∞–≥–∞","–∫–∞—Ä—Ç–æ–Ω","–ø–ª–∞—Å—Ç–∏–∫","–º–µ—Ç–∞–ª–ª",
  "—á–∞—à–∫–∞","–±–ª—é–¥—Ü–µ","—á–∞–π–Ω–∏–∫","—Ç–µ—Ä–º–æ—Å","–∫–æ—Ñ–µ–º–∞—à–∏–Ω–∞","—Ç–æ—Å—Ç–µ—Ä","–±–ª–µ–Ω–¥–µ—Ä","–º–∏–∫—Å–µ—Ä","–¥—É—Ö–æ–≤–∫–∞","–ø–ª–∏—Ç–∞"
];

        state.words = fallback;
        wordsStatus.textContent = "–°–ª–æ–≤–∞: –¥–µ–º–æ (" + fallback.length + ")";
      }
    }

    function randInt(min, maxInclusive){
      return Math.floor(Math.random() * (maxInclusive - min + 1)) + min;
    }

    function pickWord(){
      const w = state.words[randInt(0, state.words.length - 1)];
      return w;
    }

    function showScreen(which){
      screenSetup.style.display = (which === "setup") ? "" : "none";
      screenDeal.style.display  = (which === "deal")  ? "" : "none";
      screenAfter.style.display = (which === "after") ? "" : "none";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function resetGame(){
      state.playerCount = clampPlayers(parseInt(playersInput.value, 10) || 5);
      playersInput.value = String(state.playerCount);

      state.spyIndex = 0;
      state.secretWord = "";
      state.currentPlayer = 1;
      state.lastRevealFor = 1;
      state.revealedThisPlayer = false;

      hideReveal();
      showScreen("setup");
    }

    function clampPlayers(n){
      if(!Number.isFinite(n)) return 5;
      return Math.max(3, Math.min(20, n));
    }

    function startRound(){
      state.playerCount = clampPlayers(parseInt(playersInput.value, 10) || 5);
      playersInput.value = String(state.playerCount);

      state.spyIndex = randInt(1, state.playerCount);
      state.secretWord = pickWord();
      state.currentPlayer = 1;
      state.revealedThisPlayer = false;

      updateDealUI();
      showScreen("deal");
    }

    function updateDealUI(){
      dealProgress.textContent = `–ò–≥—Ä–æ–∫ ${state.currentPlayer} / ${state.playerCount}`;
      dealPlayer.textContent = `‚Ññ${state.currentPlayer}`;
    }

    function isSpy(playerIndex){
      return playerIndex === state.spyIndex;
    }

    function showReveal(forPlayer){
      state.lastRevealFor = forPlayer;

      const spy = isSpy(forPlayer);
      revealOverlay.classList.remove("normal","spy");
      revealOverlay.classList.add(spy ? "spy" : "normal");
      revealOverlay.classList.add("show");

      revealTitle.textContent = `–ò–≥—Ä–æ–∫ ‚Ññ${forPlayer}`;

      if(spy){
        revealMain.textContent = "–®–ü–ò–û–ù";
        revealSub.textContent = "–¢—ã —à–ø–∏–æ–Ω. –°–º–æ—Ç—Ä–∏ –Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏, –ø–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ.";
      }else{
        revealMain.textContent = state.secretWord.toUpperCase();
        revealSub.textContent = "–ù–∏–∫–æ–º—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π. –ó–∞–ø–æ–º–Ω–∏ –∏ –Ω–∞–∂–º–∏ ¬´–°–∫—Ä—ã—Ç—å¬ª.";
      }

      // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      if(navigator.vibrate){
        navigator.vibrate(spy ? [60, 40, 60] : 40);
      }
    }

    function hideReveal(){
      revealOverlay.classList.remove("show");
    }

    function nextPlayer(){
      if(state.currentPlayer < state.playerCount){
        state.currentPlayer++;
        state.revealedThisPlayer = false;
        updateDealUI();
      }else{
        // –∫–æ–Ω–µ—Ü —Ä–∞–∑–¥–∞—á–∏
        $("afterInfo").textContent = `–ò–≥—Ä–æ–∫–æ–≤: ${state.playerCount}`;
        showScreen("after");
      }
    }

    // --- –°–æ–±—ã—Ç–∏—è ---
    btnHow.addEventListener("click", ()=>{
      howBox.style.display = "";
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });
    btnHideHow.addEventListener("click", ()=> howBox.style.display = "none");

    btnStart.addEventListener("click", startRound);

    btnReveal.addEventListener("click", ()=>{
      // –û–¥–∏–Ω –∏–≥—Ä–æ–∫ ‚Äî –æ–¥–∏–Ω –ø–æ–∫–∞–∑, –Ω–æ –º–æ–∂–Ω–æ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë —Ä–∞–∑" –≤ –æ–≤–µ—Ä–ª–µ–µ
      showReveal(state.currentPlayer);
      state.revealedThisPlayer = true;
    });

    btnHide.addEventListener("click", ()=>{
      hideReveal();
      if(state.revealedThisPlayer){
        // –ü–æ—Å–ª–µ —Å–∫—Ä—ã—Ç–∏—è ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
        // (—á—Ç–æ–±—ã –±—ã–ª–æ —É–¥–æ–±–Ω–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ)
        nextPlayer();
      }
    });

    btnShowAgain.addEventListener("click", ()=>{
      showReveal(state.lastRevealFor);
    });

    // –ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É –æ–≤–µ—Ä–ª–µ—è ‚Äî —Ç–æ–∂–µ —Å–∫—Ä—ã—Ç—å (—É–¥–æ–±–Ω–æ –æ–¥–Ω–æ–π —Ä—É–∫–æ–π)
    revealOverlay.addEventListener("click", (e)=>{
      if(e.target === revealOverlay){
        btnHide.click();
      }
    });

    btnReset.addEventListener("click", resetGame);
    btnReset2.addEventListener("click", resetGame);

    btnNewRound.addEventListener("click", ()=>{
      // –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥ —Å —Ç–µ–º –∂–µ –∫–æ–ª-–≤–æ–º –∏–≥—Ä–æ–∫–æ–≤
      playersInput.value = String(state.playerCount);
      startRound();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (async function init(){
      // —Ä–µ–∂–∏–º
      const saved = localStorage.getItem("spy_minimal");
      setMinimal(saved === "1");

      // —Å–ª–æ–≤–∞
      await loadWords();

      // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–±—Ä–æ—Å (–ø–æ–¥—Ç—è–Ω—É—Ç—å –∏–Ω–ø—É—Ç)
      resetGame();
    })();
  </script>
</body>
</html>

